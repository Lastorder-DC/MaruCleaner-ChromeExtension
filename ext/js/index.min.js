var dom={url:location,urlBase:location.pathname.split("/"),src:[],img:[],season:[],nowView:1,addSrc:function(o){this.src.push(o)},addImg:function(o){this.img.push(o)},make:{img:function(){for(i=0;i<dom.img.length;i++)0==opt.set.CATAssistant&&$("body").append("<img src='"+dom.url.origin+dom.img[i]+"' count='"+i+"' class='view'>")},header:function(){$("body").append("<div class='view-header' id='head'><div class='left header-list bbtn hand'>목록</div><div class='left header-title'><span class='small'>"+dom.now+"개 <</span> "+dom.name.base+" <span class='small'>> "+(dom.season.length-dom.now-1)+"개</span></div></div>"),$("div.view-header").prepend(dom.urlBase[2]==dom.season[0][1]?"<div class='bbtn btn-lock'>이전</div>":"<a href='"+dom.season[dom.now-1][1]+"'><div class='bbtn bdr0 only-line'>이전("+dom.season[dom.now-1][0]+")</div></a>"),$("div.view-header").append(dom.urlBase[2]==dom.season[dom.season.length-1][1]?"<div class='bbtn btn-lock'>다음</div>":"<a href='"+dom.season[dom.now+1][1]+"'><div class='bbtn bdr0 only-line'>다음("+dom.season[dom.now+1][0]+")</div></a>")},nowPage:function(){$("body").append("<div class='view-page only-line'><span class='now'>"+dom.nowView+"</span>/"+dom.img.length+"</span></div>")},lockBox:function(){$("body").append("<div class='wac5 box lock-box mt-p10 p10'><div class='b3'>이 페이지는 잠겨 있습니다.</div></div>"),$("div.lock-box").append("<form action='"+location.href+"' class='wac8 b4 mt20' method='POST'><input type='password' name='pass' placeholder='비밀번호 입력' class='w12'><button class='btn oran w12 mt10'>확인</form>")},listBox:function(){$("div.view-header").append("<div class='list-box b5 w12 hide'></div>"),$.each(dom.season,function(o,e){color=-1==dom.sync.dataView.indexOf(e[1])?"tblue":"tgrey",0!=o&&$(".list-box").append("<span class='l p10'> | </span>"),$(".list-box").append("<a href='http://wasabisyrup.com/archives/"+e[1]+"'><span class='"+color+" p10'>"+e[0]+"</span></a>")})}},now:{},name:{base:$("title").html(),title:function(){if(arr=this.base.split("|"),arr=this.arr[0].split(" "),name="",-1!=arr[arr.length-1].search("/(-|~)/i")&&(arr[arr.length-1]=""),arr.length<1)return base;for(i=0;i<arr.length-1;i++)0!=i&&(name+=" "),name+=arr[i];return name}},sync:{data:[],dataView:[],save:{json:""},view:{view:""}},lock:!1};opt={set:{CATAssistant:!1,QuickKey:!0,autoBookMark:!0,denyRequest:!0,forcedRemove:!0},off:!1},chrome.storage.sync.get({opt:opt},function(o){void 0==o||""==o||(opt=o.opt)}),document.onreadystatechange=function(o){if("interactive"==document.readyState&&!opt.off){for(i=0;i<o.srcElement.all.length;i++){var e=o.srcElement.all[i];"script"==e.localName?dom.addSrc(e):"img"==e.localName&&dom.addImg(e.attributes[2].value)}!function(){var o=!1;$.each($("select.list-articles > option"),function(e,n){return void 0!=dom.season[0]&&dom.season[0][1]==$(n).val()?(o=!0,!1):($(n).val()==dom.urlBase[2]&&(dom.now=dom.season.length),void dom.season.push([$(n).html().replace(/(\t|\s)+/g,""),$(n).val()]))})}(),dom.lock=0!=$("form").length?!0:!1,dom.name.base=$("div.article-title").attr("title"),console.log(opt),1==opt.set.forcedRemove&&0==opt.set.CATAssistant&&($(root).off(),root.remove())}"complete"!=document.readyState||opt.off||(1==dom.lock&&0==dom.img.length?dom.make.lockBox():dom.make.img(),dom.make.header(),dom.make.nowPage(),$("body").addClass("show"),console.log(opt),1==opt.set.QuickKey&&$(document).on("keydown",function(o){return 38==o.keyCode?(no=Number(dom.nowView)-2,0>=no&&(prep=0),prep=$("img.view")[no],$(window).scrollTop($(prep).offset().top),!1):40==o.keyCode?(no=dom.nowView,dom.img.length-1<no&&(no=dom.img.length),next=$("img.view")[no],$(window).scrollTop($(next).offset().top),!1):37==o.keyCode?(void 0!==dom.season[dom.now-1]&&(location.href=dom.season[dom.now-1][1]),!1):39==o.keyCode?(void 0!==dom.season[dom.now+1]&&(location.href=dom.season[dom.now+1][1]),!1):void 0}),$(function(){var o=0;$(window).scroll(function(){var e=$(this).scrollTop();e>o?(now=$(document).scrollTop()+$(window).height(),max=$(document).height(),now==max?($("div.view-header").removeClass("bye"),$("span.now").html(dom.img.length)):$("div.view-header").addClass("bye")):$("div.view-header").removeClass("bye"),$.each($("img.view"),function(o,e){return $(e).offset().top-$(window).height()/3>$(window).scrollTop()?(dom.nowView=$(e).attr("count"),$("span.now").html(dom.nowView),!1):void 0}),o=e})}),$(document).on("click",".header-list",function(){$(".list-box").toggleClass("hide")}),1==opt.set.autoBookMark&&chrome.storage.sync.get(dom.sync.save,function(o){void 0==o||""==o.json?o={json:"[]"}:dom.sync.data=JSON.parse(o.json),dom.sync.data.length>100&&(dom.sync.data=dom.sync.data.slice(1)),save=dom.sync.data;var e=-1;save.forEach(function(o,n){o.name==dom.name.title()&&(e=n)}),-1==e&&(e=save.length),reg=dom.season[dom.now][0].search(/[\uAC00-\uAD8B-\uAD8D-\uD0C3-\uD0C5-\uD3B7-\uD3B9-\uD653-\uD655-\uD7A3]+/i),-1==reg&&(save[e]={name:dom.name.title(),size:dom.season.length,link:dom.season[dom.now]}),dom.sync.save.json=JSON.stringify(save),chrome.storage.sync.set(dom.sync.save,function(){})}),chrome.storage.sync.get(dom.sync.view,function(o){""==o.view&&(o={view:"[]"}),dom.sync.dataView=JSON.parse(o.view),isset=dom.sync.dataView.indexOf(dom.season[dom.now][1]),-1==isset&&(dom.sync.dataView[dom.sync.dataView.length]=dom.season[dom.now][1],dom.sync.view.view=JSON.stringify(dom.sync.dataView),chrome.storage.sync.set(dom.sync.view,function(){})),dom.make.listBox()}))};